<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد مواقع احترافية - xAI</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --gradient: linear-gradient(135deg, #007bff, #00d4ff);
            --background: #f4f4f4;
            --text: #333;
            --card-bg: #fff;
        }
        [data-theme="dark"] {
            --background: #1a1a1a;
            --text: #f4f4f4;
            --card-bg: #2c2c2c;
        }
        body {
            font-family: 'Cairo', sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: background 0.5s ease;
        }
        h1 {
            color: var(--primary);
            margin-bottom: 30px;
            font-weight: 700;
            animation: fadeInDown 1s ease;
        }
        .form-control, .form-control:focus {
            border-radius: 10px;
            box-shadow: none;
            border: 2px solid var(--primary);
            transition: all 0.3s ease;
            background: var(--card-bg);
            color: var(--text);
        }
        textarea {
            height: 150px;
        }
        .btn {
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: white;
        }
        .btn-primary { background: var(--primary); border: none; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4); }
        .btn-success { background: #28a745; }
        .btn-info { background: #17a2b8; }
        .btn-info:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4); }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-edit { background: #ff6f61; }
        .btn-edit:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(255, 111, 97, 0.4); }
        .btn-reset { background: #dc3545; }
        .btn-reset:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4); }
        .btn-save { background: #6f42c1; }
        .btn-save:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(111, 66, 193, 0.4); }
        .btn-submit { background: #20c997; }
        .btn-submit:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(32, 201, 151, 0.4); }
        .btn-format { background: #fd7e14; }
        .btn-format:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(253, 126, 20, 0.4); }
        .btn-share { background: #0dcaf0; }
        .btn-share:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(13, 202, 240, 0.4); }
        .CodeMirror {
            height: 300px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text);
            margin-top: 20px;
        }
        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }
        .preview-modal iframe {
            width: 90%;
            height: 90%;
            border: none;
            background: #fff;
            border-radius: 10px;
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        .preview-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px; /* تقليل المسافة بين الأزرار */
            z-index: 1001;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        .preview-controls .btn {
            padding: 5px; /* تصغير الأزرار */
            font-size: 12px; /* تصغير حجم الأيقونة */
            width: 30px; /* عرض ثابت صغير */
            height: 30px; /* ارتفاع ثابت صغير */
            border-radius: 50%; /* دائرة */
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        .preview-controls .btn:hover {
            transform: scale(1.1); /* تأثير تكبير عند المرور */
        }
        .preview-controls .close-btn {
            background: #dc3545;
        }
        .preview-controls .close-btn:hover {
            background: #c82333;
        }
        .preview-controls .btn-info {
            background: #17a2b8;
        }
        .preview-controls .btn-info:hover {
            background: #138496;
        }
        .preview-controls .btn-warning {
            background: #ffc107;
            color: #333;
        }
        .preview-controls .btn-warning:hover {
            background: #e0a800;
        }
        .preview-controls .image-select-btn {
            background: #28a745;
        }
        .preview-controls .image-select-btn:hover {
            background: #218838;
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            animation: fadeIn 0.5s ease;
        }
        .loading-screen.hidden {
            display: none;
        }
        .theme-btn, .lang-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-right: 10px;
        }
        .control-buttons {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        .info-text {
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text);
        }
        .input-container {
            position: relative;
        }
        .gallery-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }
        .gallery-btn img {
            width: 24px;
            height: 24px;
        }
        #imageInput {
            display: none;
        }
        #imagePreview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            display: none;
            border-radius: 5px;
        }
        #editSection {
            display: none;
            margin-top: 20px;
        }
        .template-select, .language-select {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            background: var(--card-bg);
            color: var(--text);
        }
        #customCodeSection {
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid var(--secondary);
        }
        #customCodeSection textarea {
            height: 200px;
        }
        .image-sidebar {
            position: absolute;
            left: 20px;
            top: 15%;
            width: 120px;
            max-height: 70%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 8px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            display: none;
            border: 1px solid var(--primary);
        }
        .image-sidebar .image-item {
            margin-bottom: 10px;
            text-align: center;
        }
        .image-sidebar img {
            width: 100%;
            height: auto;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 5px;
            transition: border 0.3s ease, transform 0.2s ease;
        }
        .image-sidebar img:hover, .image-sidebar img.selected {
            border: 2px solid var(--primary);
            transform: scale(1.05);
        }
        .image-sidebar .image-name {
            font-size: 12px;
            color: var(--text);
            word-wrap: break-word;
            margin-top: 5px;
        }
        @media (max-width: 768px) {
            .container { margin: 20px; padding: 20px; }
            .btn { width: 100%; margin-bottom: 10px; }
            .preview-modal iframe { width: 95%; height: 80%; }
            .CodeMirror { height: 200px; }
            .image-sidebar { width: 100px; left: 10px; }
            .preview-controls { gap: 3px; padding: 3px; }
            .preview-controls .btn { width: 25px; height: 25px; font-size: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-buttons">
            <button class="btn theme-btn" onclick="toggleTheme()" data-lang="ar">🌙 الوضع الليلي</button>
            <button class="btn theme-btn" onclick="toggleTheme()" data-lang="en" style="display: none;">🌙 Dark Mode</button>
            <button class="btn lang-btn" onclick="toggleLanguage()" data-lang="ar">EN</button>
            <button class="btn lang-btn" onclick="toggleLanguage()" data-lang="en" style="display: none;">AR</button>
        </div>

        <h1 class="animate__animated animate__fadeInDown" data-lang="ar">مولد مواقع احترافية باستخدام الذكاء الاصطناعي</h1>
        <h1 class="animate__animated animate__fadeInDown" data-lang="en" style="display: none;">Professional Website Generator with AI</h1>
        
        <div class="info-text" data-lang="ar">اكتب وصفًا دقيقًا للموقع الذي تريده، أو اختر مثالًا جاهزًا من القائمة.</div>
        <div class="info-text" data-lang="en" style="display: none;">Enter a precise description of the website you want, or choose a ready-made example from the list.</div>
        
        <!-- قائمة الأمثلة الجاهزة -->
        <label for="templateSelect" data-lang="ar">اختر مثالًا جاهزًا (اختياري):</label>
        <label for="templateSelect" data-lang="en" style="display: none;">Choose a Ready-Made Example (Optional):</label>
        <select id="templateSelect" class="template-select" onchange="fillDescription()">
            <option value="">-- اختر مثالًا --</option>
            <option value="متجر إلكتروني احترافي بألوان زرقاء وبيضاء">متجر إلكتروني</option>
            <option value="موقع شخصي بتصميم بسيط وأنيق">موقع شخصي</option>
            <option value="مدونة بتصميم عصري مع قسم للتعليقات">مدونة</option>
            <option value="موقع محادثة مع ذكاء اصطناعي">موقع محادثة</option>
        </select>

        <!-- اختيار لغة الموقع المنشأ -->
        <label for="languageSelect" data-lang="ar">اختر لغة الموقع المنشأ:</label>
        <label for="languageSelect" data-lang="en" style="display: none;">Choose Generated Website Language:</label>
        <select id="languageSelect" class="language-select">
            <option value="ar">العربية</option>
            <option value="en">English</option>
        </select>
        
        <label for="siteDescription" data-lang="ar">وصف الموقع:</label>
        <label for="siteDescription" data-lang="en" style="display: none;">Website Description:</label>
        <div class="input-container">
            <textarea class="form-control animate__animated animate__fadeIn" id="siteDescription" placeholder="مثال: موقع محادثة مع ذكاء اصطناعي" data-lang="ar"></textarea>
            <textarea class="form-control animate__animated animate__fadeIn" id="siteDescriptionEn" placeholder="Example: A chat website with AI" data-lang="en" style="display: none;"></textarea>
            <button class="gallery-btn" onclick="document.getElementById('imageInput').click()">
                <img src="https://cdn-icons-png.flaticon.com/512/104/104668.png" alt="Gallery Icon">
            </button>
            <input type="file" id="imageInput" accept="image/*">
        </div>
        <img id="imagePreview" alt="معاينة الصورة">
        
        <!-- حقل الكود الرئيسي -->
        <label data-lang="ar">الكود المنشأ:</label>
        <label data-lang="en" style="display: none;">Generated Code:</label>
        <textarea id="codeOutput" class="form-control" style="display: none;"></textarea>
        <div id="codeEditorAr" style="height: 300px;"></div>
        <textarea id="codeOutputEn" class="form-control" style="display: none;"></textarea>
        <div id="codeEditorEn" style="height: 300px; display: none;"></div>
        
        <br>
        <button class="btn btn-primary w-100 animate__animated animate__pulse" onclick="generateWebsite()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="إنشاء موقع جديد بناءً على الوصف">
            <i class="fas fa-magic"></i> إنشاء الموقع
        </button>
        <button class="btn btn-primary w-100 animate__animated animate__pulse" onclick="generateWebsite()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Generate a new website based on the description">
            <i class="fas fa-magic"></i> Generate Website
        </button>
        
        <!-- خانة التعديل -->
        <div id="editSection">
            <label for="editDescription" data-lang="ar">التعديلات المطلوبة:</label>
            <label for="editDescription" data-lang="en" style="display: none;">Requested Modifications:</label>
            <textarea class="form-control" id="editDescription" placeholder="مثال: غير لون الخلفية إلى الأحمر" data-lang="ar"></textarea>
            <textarea class="form-control" id="editDescriptionEn" placeholder="Example: Change the background color to red" data-lang="en" style="display: none;"></textarea>
        </div>
        
        <br>
        <button class="btn btn-success w-100" onclick="copyCode()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="نسخ الكود إلى الحافظة">
            <i class="fas fa-copy"></i> نسخ الكود
        </button>
        <button class="btn btn-success w-100" onclick="copyCode()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy the code to clipboard">
            <i class="fas fa-copy"></i> Copy Code
        </button>
        <button class="btn btn-info w-100" onclick="previewCode()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="معاينة الموقع في نافذة كبيرة">
            <i class="fas fa-eye"></i> معاينة الموقع
        </button>
        <button class="btn btn-info w-100" onclick="previewCode()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Preview the website in a large window">
            <i class="fas fa-eye"></i> Preview Website
        </button>
        <button class="btn btn-warning w-100" onclick="downloadCode()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="تحميل الكود كملف HTML">
            <i class="fas fa-download"></i> تحميل الملف
        </button>
        <button class="btn btn-warning w-100" onclick="downloadCode()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Download the code as an HTML file">
            <i class="fas fa-download"></i> Download File
        </button>
        <button class="btn btn-edit w-100" onclick="editWebsite()" data-lang="ar" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="تعديل الموقع بناءً على التعديلات المطلوبة">
            <i class="fas fa-edit"></i> تعديل
        </button>
        <button class="btn btn-edit w-100" onclick="editWebsite()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit the website based on the requested modifications">
            <i class="fas fa-edit"></i> Edit
        </button>
        <button class="btn btn-save w-100" onclick="saveManualEdits()" data-lang="ar" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="حفظ التعديلات التي أجريتها يدويًا">
            <i class="fas fa-save"></i> حفظ التعديلات اليدوية
        </button>
        <button class="btn btn-save w-100" onclick="saveManualEdits()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Save the edits you made manually">
            <i class="fas fa-save"></i> Save Manual Edits
        </button>
        <button class="btn btn-format w-100" onclick="formatCode()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="تنسيق الكود ليكون أكثر وضوحًا">
            <i class="fas fa-align-left"></i> تنسيق الكود
        </button>
        <button class="btn btn-format w-100" onclick="formatCode()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Format the code to be more readable">
            <i class="fas fa-align-left"></i> Format Code
        </button>
        <button class="btn btn-share w-100" onclick="shareCode()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="مشاركة الكود عبر رابط">
            <i class="fas fa-share-alt"></i> مشاركة الكود
        </button>
        <button class="btn btn-share w-100" onclick="shareCode()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Share the code via a link">
            <i class="fas fa-share-alt"></i> Share Code
        </button>
        <button class="btn btn-reset w-100" onclick="resetAll()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="إعادة تعيين كل الحقول والبدء من جديد">
            <i class="fas fa-undo"></i> إعادة تعيين
        </button>
        <button class="btn btn-reset w-100" onclick="resetAll()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Reset all fields and start over">
            <i class="fas fa-undo"></i> Reset
        </button>

        <!-- قسم لصق وتعديل الكود -->
        <div id="customCodeSection">
            <h3 data-lang="ar">تعديل كود ملصق</h3>
            <h3 data-lang="en" style="display: none;">Edit Pasted Code</h3>
            <label for="customCode" data-lang="ar">الصق الكود هنا:</label>
            <label for="customCode" data-lang="en" style="display: none;">Paste the Code Here:</label>
            <textarea class="form-control" id="customCode" placeholder="الصق الكود الذي تريد تعديله"></textarea>
            <label for="customEditDescription" data-lang="ar">التعديلات المطلوبة:</label>
            <label for="customEditDescription" data-lang="en" style="display: none;">Requested Modifications:</label>
            <textarea class="form-control" id="customEditDescription" placeholder="مثال: غير لون الخلفية إلى الأحمر"></textarea>
            <br>
            <button class="btn btn-submit w-100" onclick="editCustomCode()" data-lang="ar" data-bs-toggle="tooltip" data-bs-placement="top" title="إرسال الكود والتعديلات للمعالجة">
                <i class="fas fa-paper-plane"></i> إرسال
            </button>
            <button class="btn btn-submit w-100" onclick="editCustomCode()" data-lang="en" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="top" title="Submit the code and modifications for processing">
                <i class="fas fa-paper-plane"></i> Submit
            </button>
        </div>

        <!-- نافذة المعاينة -->
        <div id="previewContainer" class="preview-modal">
            <div class="preview-controls">
                <button class="btn close-btn" onclick="closePreview()" title="إغلاق" data-lang="ar"><i class="fas fa-times"></i></button>
                <button class="btn close-btn" onclick="closePreview()" title="Close" data-lang="en" style="display: none;"><i class="fas fa-times"></i></button>
                <button class="btn btn-info" onclick="zoomIn()" title="تكبير" data-lang="ar"><i class="fas fa-plus"></i></button>
                <button class="btn btn-info" onclick="zoomIn()" title="Zoom In" data-lang="en" style="display: none;"><i class="fas fa-plus"></i></button>
                <button class="btn btn-info" onclick="zoomOut()" title="تصغير" data-lang="ar"><i class="fas fa-minus"></i></button>
                <button class="btn btn-info" onclick="zoomOut()" title="Zoom Out" data-lang="en" style="display: none;"><i class="fas fa-minus"></i></button>
                <button class="btn btn-warning" onclick="refreshPreview()" title="تحديث" data-lang="ar"><i class="fas fa-sync-alt"></i></button>
                <button class="btn btn-warning" onclick="refreshPreview()" title="Refresh" data-lang="en" style="display: none;"><i class="fas fa-sync-alt"></i></button>
                <button class="btn image-select-btn" id="selectImageBtn" onclick="document.getElementById('selectImageInput').click()" title="اختيار صورة" data-lang="ar"><i class="fas fa-image"></i></button>
                <button class="btn image-select-btn" id="selectImageBtn" onclick="document.getElementById('selectImageInput').click()" title="Select Image" data-lang="en" style="display: none;"><i class="fas fa-image"></i></button>
            </div>
            <iframe id="previewFrame"></iframe>
            <div id="imageSidebar" class="image-sidebar"></div>
            <input type="file" id="selectImageInput" accept="image/*" style="display: none;">
        </div>

        <div id="loadingScreen" class="loading-screen hidden">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">جاري التحميل...</span>
            </div>
            <p class="mt-3" data-lang="ar">جاري إنشاء الموقع...</p>
            <p class="mt-3" data-lang="en" style="display: none;">Generating website...</p>
        </div>

        <!-- حقوق المصمم -->
        <div class="text-center mt-4">
            <p data-lang="ar">تم التصميم والبرمجة بواسطة <strong>مصطفى حسين</strong></p>
            <p data-lang="en" style="display: none;">Designed and developed by <strong>Mustafa Hussein</strong></p>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
    <!-- Prettier (لتنسيق الكود) -->
    <script src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-html.js"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const API_KEY = "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";
        const MODEL_NAME = "deepseek/deepseek-chat-v3-0324:free";  
        const API_URL = "https://openrouter.ai/api/v1/chat/completions";

        let currentTheme = "light";
        let currentLanguage = "ar";
        let currentCode = ""; 
        let imageFile = null; 
        let imageUrl = null; 
        let codeEditorAr, codeEditorEn; 
        let originalDescription = ""; 
        let zoomLevel = 1; 

        window.onload = function() {
            const codeOutputAr = document.getElementById('codeOutput');
            const codeOutputEn = document.getElementById('codeOutputEn');

            if (codeOutputAr && codeOutputEn) {
                codeEditorAr = CodeMirror(document.getElementById('codeEditorAr'), {
                    value: '',
                    mode: 'htmlmixed',
                    theme: 'default',
                    lineNumbers: true,
                    readOnly: false
                });

                codeEditorEn = CodeMirror(document.getElementById('codeEditorEn'), {
                    value: '',
                    mode: 'htmlmixed',
                    theme: 'default',
                    lineNumbers: true,
                    readOnly: false
                });
            } else {
                console.error("لم يتم العثور على عنصر codeOutput أو codeOutputEn!");
            }

            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        };

        function formatCodeContent(code) {
            try {
                return prettier.format(code, {
                    parser: "html",
                    plugins: prettierPlugins,
                    tabWidth: 2,
                    useTabs: false,
                    printWidth: 80,
                });
            } catch (error) {
                console.error("Error formatting code:", error);
                return code;
            }
        }

        function fillDescription() {
            const templateSelect = document.getElementById('templateSelect').value;
            if (currentLanguage === "ar") {
                document.getElementById('siteDescription').value = templateSelect;
            } else {
                document.getElementById('siteDescriptionEn').value = templateSelect;
            }
        }

        document.getElementById('imageInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                imageFile = file;
                imageUrl = URL.createObjectURL(file);
                const preview = document.getElementById('imagePreview');
                preview.src = imageUrl;
                preview.style.display = 'block';
            }
        });

        function resetImageInput() {
            imageFile = null;
            if (imageUrl) {
                URL.revokeObjectURL(imageUrl);
                imageUrl = null;
            }
            const imageInput = document.getElementById('imageInput');
            const imagePreview = document.getElementById('imagePreview');
            imageInput.value = '';
            imagePreview.src = '';
            imagePreview.style.display = 'none';
        }

        function toggleTheme() {
            currentTheme = currentTheme === "light" ? "dark" : "light";
            document.body.setAttribute("data-theme", currentTheme);
            const themeBtns = document.querySelectorAll(".theme-btn");
            themeBtns.forEach(btn => {
                if (btn.getAttribute("data-lang") === "ar") {
                    btn.textContent = currentTheme === "light" ? "🌙 الوضع الليلي" : "☀️ الوضع النهاري";
                } else {
                    btn.textContent = currentTheme === "light" ? "🌙 Dark Mode" : "☀️ Light Mode";
                }
            });
            if (codeEditorAr && codeEditorEn) {
                codeEditorAr.setOption("theme", currentTheme === "light" ? "default" : "monokai");
                codeEditorEn.setOption("theme", currentTheme === "light" ? "default" : "monokai");
            }
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === "ar" ? "en" : "ar";
            document.querySelectorAll("[data-lang]").forEach(el => {
                el.style.display = el.getAttribute("data-lang") === currentLanguage ? "block" : "none";
            });
            document.querySelectorAll(".lang-btn").forEach(btn => {
                btn.textContent = currentLanguage === "ar" ? "EN" : "AR";
            });
            updatePreviewControlsLanguage();
        }

        function updatePreviewControlsLanguage() {
            document.querySelectorAll(".preview-controls .btn").forEach(btn => {
                btn.style.display = btn.getAttribute("data-lang") === currentLanguage ? "inline-flex" : "none";
            });
        }

        async function generateWebsite() {
            const desc = currentLanguage === "ar" ? document.getElementById('siteDescription').value.trim() : document.getElementById('siteDescriptionEn').value.trim();
            const siteLanguage = document.getElementById('languageSelect').value;
            if (!desc) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "يرجى كتابة وصف للموقع!" : "Please enter a description for the website!",
                });
                return;
            }

            document.getElementById('loadingScreen').classList.remove('hidden');
            originalDescription = desc;

            let prompt = `
                أنشئ كود HTML احترافي جدًا لموقع "${desc}"
                باستخدام أحدث إصدارات المكتبات التالية:
                - Bootstrap 5.3.2 للتصميم المتجاوب
                - Tailwind CSS للألوان والتنسيق المتقدم
                - Font Awesome 6.4.2 للرموز
                - Animate.css 4.1.1 للأنيميشن
                - GSAP 3.12.2 للتأثيرات التفاعلية
                - Google Fonts (استخدم خطوط مثل Cairo و Roboto)
                اجعل التصميم عصري جدًا، متجاوب، سريع التحميل، ومناسب لنوع الموقع المطلوب (مثل مواقع الدردشة، المتاجر الإلكترونية، المواقع الشخصية، إلخ).
                أضف تأثيرات تفاعلية وأنيميشن سلس باستخدام GSAP و Animate.css.
                استخدم ألوان متناسقة من Tailwind CSS (مثل bg-blue-500، text-gray-800، إلخ).
                أضف رموز من Font Awesome لتحسين الشكل (مثل أيقونات للأزرار أو القوائم).
                اجعل الكود نظيفًا ومنظمًا بدون تعليقات.
                تأكد من أن الموقع يعكس بالضبط ما تم وصفه في "${desc}".
                اجعل لغة الموقع المنشأ "${siteLanguage === 'ar' ? 'العربية' : 'الإنجليزية'}".
                أرجع الكود كملف HTML واحد يحتوي على الـ CSS والـ JavaScript داخله (بدون تقسيم).
            `;

            let addImage = false;
            if (desc.includes('وضع الصورة') || desc.includes('add the image')) {
                if (!imageFile) {
                    Swal.fire({
                        icon: 'warning',
                        title: currentLanguage === "ar" ? "خطأ" : "Error",
                        text: currentLanguage === "ar" ? "يرجى رفع صورة أولاً!" : "Please upload an image first!",
                    });
                    document.getElementById('loadingScreen').classList.add('hidden');
                    return;
                }
                addImage = true;
                prompt += `\nوأضف مكانًا لصورة في الموقع (مثلاً داخل <div class="user-image"> في الـ body).`;
            }

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: MODEL_NAME,
                        messages: [{ role: "user", content: prompt }],
                        max_tokens: 10000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (!data || !data.choices || !data.choices[0].message) {
                    throw new Error("استجابة الـ API غير صالحة!");
                }

                let code = data.choices[0].message.content;
                let extractedCode = code.match(/```html([\s\S]*?)```/)?.[1]?.trim() || code.trim();

                if (addImage) {
                    const imageTag = `<img src="${imageUrl}" alt="صورة المستخدم" class="max-w-full rounded-lg block mx-auto my-5">`;
                    if (extractedCode.includes('<div class="user-image">')) {
                        extractedCode = extractedCode.replace('<div class="user-image">', `<div class="user-image">${imageTag}`);
                    } else {
                        extractedCode = extractedCode.replace('</body>', `<div class="user-image">${imageTag}</div>\n</body>`);
                    }
                }

                extractedCode = formatCodeContent(extractedCode);

                currentCode = extractedCode;
                if (currentLanguage === "ar") {
                    codeEditorAr.setValue(extractedCode);
                } else {
                    codeEditorEn.setValue(extractedCode);
                }
                gsap.from('.CodeMirror', { opacity: 0, y: 20, duration: 0.5 });

                document.getElementById('editSection').style.display = 'block';
                document.querySelectorAll('.btn-edit').forEach(btn => {
                    btn.style.display = btn.getAttribute("data-lang") === currentLanguage ? "block" : "none";
                });
                document.querySelectorAll('.btn-save').forEach(btn => {
                    btn.style.display = btn.getAttribute("data-lang") === currentLanguage ? "block" : "none";
                });

                resetImageInput();
            } catch (error) {
                console.error("Error:", error);
                Swal.fire({
                    icon: 'error',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "حدث خطأ أثناء إنشاء الموقع! " + error.message : "An error occurred while generating the website! " + error.message,
                });
            } finally {
                document.getElementById('loadingScreen').classList.add('hidden');
            }
        }

        async function editWebsite() {
            const editDesc = currentLanguage === "ar" ? document.getElementById('editDescription').value.trim() : document.getElementById('editDescriptionEn').value.trim();
            if (!editDesc) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "يرجى كتابة التعديلات المطلوبة!" : "Please enter the modifications you want!",
                });
                return;
            }

            if (!currentCode) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود لتعديله! يرجى إنشاء موقع أولاً." : "No code to edit! Please generate a website first.",
                });
                return;
            }

            document.getElementById('loadingScreen').classList.remove('hidden');

            let prompt = `
                لديك الكود التالي لموقع تم إنشاؤه بناءً على الوصف الأصلي: "${originalDescription}"
                الكود هو:
                \`\`\`html
                ${currentCode}
                \`\`\`
                الآن، المستخدم يريد إجراء التعديلات التالية على الموقع: "${editDesc}"
                قم بتعديل الكود بناءً على التعديلات المطلوبة مع الحفاظ على التصميم الاحترافي.
                استخدم نفس المكتبات المستخدمة في الكود الأصلي:
                - Bootstrap 5.3.2
                - Tailwind CSS
                - Font Awesome 6.4.2
                - Animate.css 4.1.1
                - GSAP 3.12.2
                - Google Font (Cairo و Roboto)
                اجعل التعديلات دقيقة ومناسبة للوصف، مع الحفاظ على التصميم العصري والمتجاوب.
                أضف تأثيرات تفاعلية وأنيميشن سلس إذا لزم الأمر.
                اجعل الكود نظيفًا ومنظمًا بدون تعليقات.
                أرجع الكود كملف HTML واحد يحتوي على الـ CSS والـ JavaScript داخله (بدون تقسيم).
            `;

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: MODEL_NAME,
                        messages: [{ role: "user", content: prompt }],
                        max_tokens: 6000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (!data || !data.choices || !data.choices[0].message) {
                    throw new Error("استجابة الـ API غير صالحة!");
                }

                let code = data.choices[0].message.content;
                let extractedCode = code.match(/```html([\s\S]*?)```/)?.[1]?.trim() || code.trim();

                extractedCode = formatCodeContent(extractedCode);

                currentCode = extractedCode;
                if (currentLanguage === "ar") {
                    codeEditorAr.setValue(extractedCode);
                } else {
                    codeEditorEn.setValue(extractedCode);
                }
                gsap.from('.CodeMirror', { opacity: 0, y: 20, duration: 0.5 });

                if (currentLanguage === "ar") {
                    document.getElementById('editDescription').value = '';
                } else {
                    document.getElementById('editDescriptionEn').value = '';
                }
            } catch (error) {
                console.error("Error:", error);
                Swal.fire({
                    icon: 'error',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "حدث خطأ أثناء تعديل الموقع! " + error.message : "An error occurred while editing the website! " + error.message,
                });
            } finally {
                document.getElementById('loadingScreen').classList.add('hidden');
            }
        }

        async function editCustomCode() {
            const customCode = document.getElementById('customCode').value.trim();
            const customEditDesc = document.getElementById('customEditDescription').value.trim();

            if (!customCode) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "يرجى لصق الكود أولاً!" : "Please paste the code first!",
                });
                return;
            }
            if (!customEditDesc) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "يرجى كتابة التعديلات المطلوبة!" : "Please enter the modifications you want!",
                });
                return;
            }

            if (!customCode.includes('<html') || !customCode.includes('</html>')) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "الكود الملصق ليس كود HTML صالح! يرجى التأكد من أنه يحتوي على <html> و </html>" : "The pasted code is not valid HTML! Please ensure it contains <html> and </html>",
                });
                return;
            }

            document.getElementById('loadingScreen').classList.remove('hidden');

            let prompt = `
                لديك الكود التالي:
                \`\`\`html
                ${customCode}
                \`\`\`
                المستخدم يريد إجراء التعديلات التالية على الكود: "${customEditDesc}"
                قم بتعديل الكود بناءً على التعديلات المطلوبة مع الحفاظ على التصميم الاحترافي.
                إذا كان الكود يستخدم مكتبات معينة، حاول الحفاظ عليها أو تحسينها إذا لزم الأمر.
                اجعل التعديلات دقيقة ومناسبة للوصف، مع الحفاظ على التصميم العصري والمتجاوب.
                اجعل الكود نظيفًا ومنظمًا بدون تعليقات.
                أرجع الكود كملف HTML واحد يحتوي على الـ CSS والـ JavaScript داخله (بدون تقسيم).
            `;

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: MODEL_NAME,
                        messages: [{ role: "user", content: prompt }],
                        max_tokens: 6000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (!data || !data.choices || !data.choices[0].message) {
                    throw new Error("استجابة الـ API غير صالحة! الاستجابة: " + JSON.stringify(data));
                }

                let code = data.choices[0].message.content;
                let extractedCode = code.match(/```html([\s\S]*?)```/)?.[1]?.trim() || code.trim();

                extractedCode = formatCodeContent(extractedCode);

                currentCode = extractedCode;
                if (currentLanguage === "ar") {
                    codeEditorAr.setValue(extractedCode);
                } else {
                    codeEditorEn.setValue(extractedCode);
                }
                gsap.from('.CodeMirror', { opacity: 0, y: 20, duration: 0.5 });

                document.getElementById('customCode').value = '';
                document.getElementById('customEditDescription').value = '';

                Swal.fire({
                    icon: 'success',
                    title: currentLanguage === "ar" ? "تم" : "Success",
                    text: currentLanguage === "ar" ? "تم تعديل الكود بنجاح!" : "Code edited successfully!",
                });
            } catch (error) {
                console.error("Error:", error);
                Swal.fire({
                    icon: 'error',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "حدث خطأ أثناء تعديل الكود! " + error.message : "An error occurred while editing the code! " + error.message,
                });
            } finally {
                document.getElementById('loadingScreen').classList.add('hidden');
            }
        }

        function saveManualEdits() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            if (!code.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود لحفظه!" : "No code to save!",
                });
                return;
            }
            currentCode = code;
            Swal.fire({
                icon: 'success',
                title: currentLanguage === "ar" ? "تم" : "Success",
                text: currentLanguage === "ar" ? "تم حفظ التعديلات اليدوية!" : "Manual edits saved!",
            });
        }

        function formatCode() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            if (!code.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود لتنسيقه!" : "No code to format!",
                });
                return;
            }

            try {
                const formattedCode = formatCodeContent(code);
                currentCode = formattedCode;
                if (currentLanguage === "ar") {
                    codeEditorAr.setValue(formattedCode);
                } else {
                    codeEditorEn.setValue(formattedCode);
                }
                Swal.fire({
                    icon: 'success',
                    title: currentLanguage === "ar" ? "تم" : "Success",
                    text: currentLanguage === "ar" ? "تم تنسيق الكود بنجاح!" : "Code formatted successfully!",
                });
            } catch (error) {
                console.error("Error formatting code:", error);
                Swal.fire({
                    icon: 'error',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "حدث خطأ أثناء تنسيق الكود! " + error.message : "An error occurred while formatting the code! " + error.message,
                });
            }
        }

        async function shareCode() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            if (!code.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود لمشاركته!" : "No code to share!",
                });
                return;
            }

            try {
                const blob = new Blob([code], { type: 'text/html' });
                const formData = new FormData();
                formData.append('file', blob, 'index.html');

                const response = await fetch('https://file.io', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    const shareLink = data.link;
                    Swal.fire({
                        icon: 'success',
                        title: currentLanguage === "ar" ? "تم" : "Success",
                        html: `${currentLanguage === "ar" ? "تم إنشاء رابط المشاركة:" : "Share link generated:"}<br><a href="${shareLink}" target="_blank">${shareLink}</a>`,
                        showConfirmButton: true,
                    });
                } else {
                    throw new Error("فشل في رفع الملف!");
                }
            } catch (error) {
                console.error("Error sharing code:", error);
                Swal.fire({
                    icon: 'error',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "حدث خطأ أثناء مشاركة الكود! " + error.message : "An error occurred while sharing the code! " + error.message,
                });
            }
        }

        function resetAll() {
            currentCode = "";
            originalDescription = "";
            if (currentLanguage === "ar") {
                document.getElementById('siteDescription').value = '';
                document.getElementById('editDescription').value = '';
                codeEditorAr.setValue('');
            } else {
                document.getElementById('siteDescriptionEn').value = '';
                document.getElementById('editDescriptionEn').value = '';
                codeEditorEn.setValue('');
            }
            document.getElementById('templateSelect').value = '';
            document.getElementById('languageSelect').value = 'ar';
            document.getElementById('customCode').value = '';
            document.getElementById('customEditDescription').value = '';
            document.getElementById('editSection').style.display = 'none';
            document.querySelectorAll('.btn-edit').forEach(btn => btn.style.display = 'none');
            document.querySelectorAll('.btn-save').forEach(btn => btn.style.display = 'none');
            resetImageInput();
            Swal.fire({
                icon: 'success',
                title: currentLanguage === "ar" ? "تم" : "Success",
                text: currentLanguage === "ar" ? "تم إعادة تعيين كل شيء!" : "Everything has been reset!",
            });
        }

        function copyCode() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            if (!code.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود للنسخ!" : "No code to copy!",
                });
                return;
            }
            navigator.clipboard.writeText(code).then(() => {
                Swal.fire({
                    icon: 'success',
                    title: currentLanguage === "ar" ? "تم" : "Success",
                    text: currentLanguage === "ar" ? "تم نسخ الكود!" : "Code copied!",
                });
            });
        }

        function previewCode() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            if (!code.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود للمعاينة!" : "No code to preview!",
                });
                return;
            }

            const iframe = document.getElementById('previewFrame').contentWindow.document;
            iframe.open();
            iframe.write(code);
            iframe.close();

            const previewContainer = document.getElementById('previewContainer');
            previewContainer.style.display = 'flex';

            updatePreviewControlsLanguage();
            populateImageSidebar(code);
            zoomLevel = 1;
            document.getElementById('previewFrame').style.transform = `scale(${zoomLevel})`;
        }

        function closePreview() {
            const previewContainer = document.getElementById('previewContainer');
            previewContainer.style.display = 'none';
            document.getElementById('imageSidebar').style.display = 'none';
        }

        function downloadCode() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            if (!code.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === "ar" ? "خطأ" : "Error",
                    text: currentLanguage === "ar" ? "لا يوجد كود لتحميله!" : "No code to download!",
                });
                return;
            }

            const blob = new Blob([code], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            a.click();
            URL.revokeObjectURL(url);
            Swal.fire({
                icon: 'success',
                title: currentLanguage === "ar" ? "تم" : "Success",
                text: currentLanguage === "ar" ? "تم تحميل الملف!" : "File downloaded!",
            });
        }

        function populateImageSidebar(code) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(code, 'text/html');
            const images = doc.getElementsByTagName('img');
            const sidebar = document.getElementById('imageSidebar');
            sidebar.innerHTML = '';

            if (images.length > 0) {
                sidebar.style.display = 'block';
                Array.from(images).forEach((img, index) => {
                    const imgElement = document.createElement('img');
                    imgElement.src = img.src;
                    imgElement.dataset.index = index;

                    const imageName = img.getAttribute('alt') || img.src.split('/').pop() || `صورة ${index + 1}`;
                    const nameElement = document.createElement('div');
                    nameElement.className = 'image-name';
                    nameElement.textContent = imageName;

                    const imageItem = document.createElement('div');
                    imageItem.className = 'image-item';
                    imageItem.appendChild(imgElement);
                    imageItem.appendChild(nameElement);

                    imgElement.addEventListener('click', () => {
                        document.querySelectorAll('.image-sidebar img').forEach(i => i.classList.remove('selected'));
                        imgElement.classList.add('selected');

                        const iframeDoc = document.getElementById('previewFrame').contentWindow.document;
                        const targetImg = iframeDoc.getElementsByTagName('img')[index];
                        if (targetImg) {
                            targetImg.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    });
                    sidebar.appendChild(imageItem);
                });
            } else {
                sidebar.style.display = 'none';
            }
        }

        document.getElementById('selectImageInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const newImageUrl = URL.createObjectURL(file);
                let code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
                const parser = new DOMParser();
                const doc = parser.parseFromString(code, 'text/html');
                
                // إضافة الصورة في نهاية الـ body إذا لم يكن هناك صور محددة
                const imageTag = `<img src="${newImageUrl}" alt="صورة جديدة" class="max-w-full rounded-lg block mx-auto my-5">`;
                const body = doc.body;
                body.insertAdjacentHTML('beforeend', imageTag);

                currentCode = doc.documentElement.outerHTML;
                currentCode = formatCodeContent(currentCode);

                if (currentLanguage === "ar") {
                    codeEditorAr.setValue(currentCode);
                } else {
                    codeEditorEn.setValue(currentCode);
                }

                const iframe = document.getElementById('previewFrame').contentWindow.document;
                iframe.open();
                iframe.write(currentCode);
                iframe.close();

                populateImageSidebar(currentCode);

                Swal.fire({
                    icon: 'success',
                    title: currentLanguage === "ar" ? "تم" : "Success",
                    text: currentLanguage === "ar" ? "تم إضافة الصورة بنجاح!" : "Image added successfully!",
                });
            }
        });

        function zoomIn() {
            zoomLevel += 0.1;
            document.getElementById('previewFrame').style.transform = `scale(${zoomLevel})`;
        }

        function zoomOut() {
            zoomLevel = Math.max(0.5, zoomLevel - 0.1);
            document.getElementById('previewFrame').style.transform = `scale(${zoomLevel})`;
        }

        function refreshPreview() {
            const code = currentLanguage === "ar" ? codeEditorAr.getValue() : codeEditorEn.getValue();
            const iframe = document.getElementById('previewFrame').contentWindow.document;
            iframe.open();
            iframe.write(code);
            iframe.close();
            populateImageSidebar(code);
        }
    </script>
</body>
</html>